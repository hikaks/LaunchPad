<!DOCTYPE html>
<html>
<head>
    <title>Strapi Login Debug</title>
</head>
<body>
    <h1>Strapi Login Debug Tool</h1>
    <div id="status">Testing...</div>

    <script>
    async function testLogin() {
        const status = document.getElementById('status');

        try {
            // Clear all storage first
            localStorage.clear();
            sessionStorage.clear();

            status.innerHTML = 'Testing login...';

            const response = await fetch('http://localhost:1337/admin/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    email: 'admin@test.com',
                    password: 'Admin123'
                })
            });

            const data = await response.json();

            if (data.data && data.data.token) {
                status.innerHTML = `
                    <h3>✅ Login Successful!</h3>
                    <p>Token: ${data.data.token.substring(0, 50)}...</p>
                    <p>User: ${data.data.user.email}</p>
                    <button onclick="testAuth()">Test Auth</button>
                `;

                // Store token
                localStorage.setItem('jwtToken', data.data.token);
                sessionStorage.setItem('jwtToken', data.data.token);

                window.testAuth = async function() {
                    const token = localStorage.getItem('jwtToken');
                    const authResponse = await fetch('http://localhost:1337/admin/users/me', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    const authData = await authResponse.json();

                    if (authData.data) {
                        status.innerHTML += '<p>✅ Authentication working!</p>';
                    } else {
                        status.innerHTML += '<p>❌ Authentication failed</p>';
                    }
                };

            } else {
                status.innerHTML = `<h3>❌ Login Failed</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
            }

        } catch (error) {
            status.innerHTML = `<h3>❌ Error</h3><pre>${error.message}</pre>`;
        }
    }

    // Auto test on load
    testLogin();
    </script>
</body>
</html>